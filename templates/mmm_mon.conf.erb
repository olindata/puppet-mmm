###########################################################
# PUPPET MANAGED                                          #
# Do not edit this file on a server node unless you       #
# are willing to have your changes overwritten by         #
# Puppet.  If you really want to change the contents      #
# repository and check it out on the puppet server.       #
###########################################################
<%
  multi_cluster_monitor = scope.lookupvar('mmm::params::multi_cluster_monitor')
  h_cluster_name        = multi_cluster_monitor ? "_#{@cluster_name}" : ''
-%>

include mmm_common<%= h_cluster_name %>.conf

<monitor>
  ip              <%= monitor_ip %>
  pid_path        /var/run/mmm_mond<%= h_cluster_name %>.pid
  bin_path        /usr/lib/mysql-mmm/
  status_path     /var/lib/misc/mmm_mond<%= h_cluster_name %>.status
<%
  ips = [];
  mastersflat = masters.flatten;

  mastersflat.each_index { |i| ips << mastersflat[i] if i % 3 == 1 }
  slaves.each_index{ |i| ips << slaves[i] if i % 2 == 1 }
-%>
  ping_ips        <%= ips.join(', ') %>
  auto_set_online 60
<% if cluster_name != '' -%>
  port          <%= port %>
<% end -%>
</monitor>

<host default>
  monitor_user        <%= monitor_user %>
  monitor_password    <%= monitor_password %>
</host>

debug 0
