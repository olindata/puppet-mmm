###########################################################
# PUPPET MANAGED                                          #
# Do not edit this file on a server node unless you       #
# are willing to have your changes overwritten by         #
# Puppet.  If you really want to change the contents      #
# repository and check it out on the puppet server.       #
###########################################################

active_master_role  writer

<host default>
  cluster_interface       <%= @cluster_interface %>

  pid_path                <%= @mmm::params::pid_path %>
  bin_path                <%= @mmm::params::bin_path %>

  replication_user        <%= @replication_user %>
  replication_password    <%= @replication_password %>

  agent_user              <%= @agent_user %>
  agent_password          <%= @agent_password %>
</host>

<%
  master_names = []
  masters.each do |master|
    master_names << master["host"]
-%>
<host <%= @master["host"] %>>
  ip            <%= @master["ip"] %>
  mode          master
  peer          <%= @master["peer"] %>
</host>
<% end -%>

<% 
  slave_names = []
  slaves.each do |slave|
    slave_names << slave["host"] 
-%>
<host <%= @slave["host"] %>>
  ip            <%= @slave["ip"] %>
  mode          slave
</host>
<% end -%>

<role writer>
  hosts          <%= master_names.join(', ') %>
  ips            <%= @writer_virtual_ip %>
  mode           exclusive
</role>

<% if readers != [] %>
<role reader>
  hosts          <%= readers.join(', ') %>
  ips            <%= reader_virtual_ips.join(', ') %>
  mode           balanced
</role>
<% end %>
