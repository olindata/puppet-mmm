###########################################################
# PUPPET MANAGED                                          #
# Do not edit this file on a server node unless you       #
# are willing to have your changes overwritten by         #
# Puppet.  If you really want to change the contents      #
# repository and check it out on the puppet server.       #
###########################################################

active_master_role  writer

<host default>
  cluster_interface       <%= cluster_interface %>

  pid_path                /var/run/mmm_agentd.pid
  bin_path                /usr/lib/mysql-mmm/

  replication_user        <%= replication_user %>
  replication_password    <%= replication_password %>

  agent_user              <%= agent_user %>
  agent_password          <%= agent_password %>
</host>

<% m = masters.flatten
   master_names = []
   host = m.shift(3)
   while ! host.empty? 
     master_names << host[0] -%>
<host <%= host[0] %>>
  ip            <%= host[1] %>
  mode          master
  peer          <%= host[2] %>
</host>
<% host = m.shift(3)
   end -%>

<% s = slaves.flatten
   host = s.shift(2)
   while ! host.empty? -%> 
<host <%= host[0] %>>
  ip            <%= host[1] %>
  mode          slave
</host>
<% host = s.shift(2)
   end -%>

<role writer>
  hosts          <%= master_names.flatten.join(', ') %>
  ips            <%= writer_virtual_ip %>
  mode           exclusive
</role>

<% if readers != [] %>
<role reader>
  hosts          <%= readers.flatten.join(', ') %>
  ips            <%= reader_virtual_ips.flatten.join(', ') %>
  mode           balanced
</role>
<% end %>
